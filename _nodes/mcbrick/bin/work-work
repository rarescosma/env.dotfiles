#!/usr/bin/env bash

# Unlock the SSH and GPG keys in one fell swoop
unlock_keys () {
  SSH_KEY="${HOME}/.ssh/id_rsa"
  ssh-add -l \
    | grep -q $(ssh-keygen -lf $SSH_KEY | awk '{print $2}')  \
    || ssh-add $SSH_KEY
  pass show bogus.site > /dev/null
}

# Inter VPN routing
inter_vpn () {
  sudo sysctl -w net.inet.ip.forwarding=1
  globalprotect-on
  tunnelblick-on
  sudo pfctl -d; sudo pfctl -e -f /etc/pf.conf; sudo pfctl -sn
}

# Disable snitches
disable_snitches () {
   xargs sudo launchctl unload <${HOME}/.disabled_svcs 2>/dev/null
   xargs launchctl unload <${HOME}/.disabled_svcs 2>/dev/null
}

main () {
  unlock_keys
  disable_snitches
}

# Verbatim, yeah!
test -z "$1" && main || $@

