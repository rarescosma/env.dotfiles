#!/usr/bin/env bash

DEVICE="wlp58s0"
ROUTER_IP="192.168.1.1"
MAC_IP="192.168.1.14"

_log() {
   printf "\n$(date +"[%Y-%m-%d %H:%M:%S]") $*\n"
}

_setgw() {
  local gw="$1"; shift
  sudo ip route del default
  sudo ip route add default via $gw dev $DEVICE
}

trap "_log 'Restoring original gateway.'; _setgw ${ROUTER_IP}" TERM INT QUIT

_log "Forwarding all traffic through McBrick..."
_setgw ${MAC_IP} 

sleep infinity

