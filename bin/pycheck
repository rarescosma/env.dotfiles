#!/usr/bin/env bash

locat() { 
  flock -e /tmp/pycheck.lock cat 
}
export -f locat

PYLINT_ARGS=""
test -f setup.cfg && PYLINT_ARGS="--rcfile=setup.cfg"
test -f pylintrc && PYLINT_ARGS="--rcfile=pylintrc"

# clean & sort imports
pycln "${@}"
isort -l80 -m3 --tc "${@}"

# format
black -l 80 "${@}"

# types are good
(mypy --ignore-missing-imports --disallow-untyped-defs "${@}" | locat) &

# messy code is bad
(pylint "${PYLINT_ARGS}" "${@}" | locat) &

wait
