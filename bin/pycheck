#!/usr/bin/env bash

locat() { 
  flock -e /tmp/pycheck.lock cat 
}
export -f locat

PYLINT_ARGS=""
test -f setup.cfg && PYLINT_ARGS="--rcfile=setup.cfg"
test -f pylintrc && PYLINT_ARGS="--rcfile=pylintrc"

# clean & sort imports
echo
echo ">>>>>> pycln <<<<<<"
pycln "${@}"
echo
echo ">>>>>> isort <<<<<<"
isort -l80 -m3 --tc "${@}"

# format
echo
echo ">>>>>> black <<<<<<"
black -l 80 "${@}"

# dead code is bad
echo
echo ">>>>>> vulture <<<<<<"
vulture "${@}"


# types are good
({
    echo
    echo ">>>>>> mypy <<<<<<"
    mypy --ignore-missing-imports --disallow-untyped-defs "${@}" 
} | locat) &

# messy code is bad
({
    echo
    echo ">>>>>> pylint <<<<<<"
    pylint "${PYLINT_ARGS}" "${@}"
} | locat) &

wait
